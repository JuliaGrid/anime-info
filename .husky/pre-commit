#!/bin/bash

# –ü–æ–ª—É—á–∞–µ–º staged —Ñ–∞–π–ª—ã
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM "*.jsx" "*.ts" "*.tsx")

if [[ -z "$STAGED_FILES" ]]; then
  echo "No staged JSX/TS files found. Skipping..."
  exit 0
fi

echo "Running checks for files"
printf '%s\n' "$STAGED_FILES"
echo "------------------------"

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–¥–µ–ª—å–Ω–æ
for file in $STAGED_FILES; do
  echo "üîç Processing $file"
  
  # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  echo "üé® Running Prettier..."
  npx prettier --write "$file"
  
  # –õ–∏–Ω—Ç–∏–Ω–≥
  echo "üßπ Running ESLint..."
  npx eslint --fix "$file"
  
#   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–µ—Å—Ç)
#   test_file="${file/.ts/.test.ts}"
#   test_file="${test_file/.tsx/.test.tsx}"
#   if [[ -f "$test_file" ]]; then
#     echo "üß™ Running tests for $file..."
#     npx jest "$test_file" --passWithNoTests
#   fi
  echo "------------------------"
done

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
echo "üåê Running global checks..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
echo "üìù Running TypeScript check..."
npx tsc --noEmit

# –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ staging
echo "‚ûï Adding fixed files to staging..."
git add $STAGED_FILES

echo "------------------------"
echo "‚úÖ All checks completed successfully!"